TYPE=VIEW
query=select `sub`.`Date_Jour` AS `Date_Jour`,`sub`.`Machine` AS `Machine`,count(0) AS `Nb_Micro_Arrets`,round(sum(`sub`.`Duree_Arret_Sec`) / 60,1) AS `Minutes_Perdues`,case when count(0) >= 15 then \'CRITIQUE ðŸ”´\' when count(0) >= 5 then \'ATTENTION ðŸŸ \' else \'NORMAL ðŸŸ¢\' end AS `Niveau_Alerte`,case when count(0) >= 15 then 3 when count(0) >= 5 then 2 else 1 end AS `Code_Couleur` from (select cast(`fp`.`Start` as date) AS `Date_Jour`,`op`.`Description` AS `Machine`,timestampdiff(SECOND,lag(`fp`.`End`,1) over ( partition by `fp`.`OpNo` order by `fp`.`Start`),`fp`.`Start`) AS `Duree_Arret_Sec` from (`mes4`.`tblfinorderpos` `fp` join `mes4`.`tbloperation` `op` on(`fp`.`OpNo` = `op`.`OpNo`)) where `fp`.`Start` is not null and `fp`.`End` is not null) `sub` where `sub`.`Duree_Arret_Sec` > 0 and `sub`.`Duree_Arret_Sec` < 300 group by `sub`.`Date_Jour`,`sub`.`Machine` order by `sub`.`Date_Jour` desc,count(0) desc
md5=159bd2e88330ca1806b8ee5b1573064c
updatable=0
algorithm=0
definer_user=root
definer_host=localhost
suid=2
with_check_option=0
timestamp=0001769793204583948
create-version=2
source=SELECT \n    sub.Date_Jour,\n    sub.Machine,\n    \n    \n    COUNT(*) AS Nb_Micro_Arrets,\n    \n    \n    ROUND(SUM(sub.Duree_Arret_Sec)/60, 1) AS Minutes_Perdues,\n    \n    \n    CASE \n        WHEN COUNT(*) >= 15 THEN \'CRITIQUE ðŸ”´\'\n        WHEN COUNT(*) >= 5 THEN \'ATTENTION ðŸŸ \'\n        ELSE \'NORMAL ðŸŸ¢\'\n    END AS Niveau_Alerte,\n    \n    \n    CASE \n        WHEN COUNT(*) >= 15 THEN 3\n        WHEN COUNT(*) >= 5 THEN 2\n        ELSE 1\n    END AS Code_Couleur\n\nFROM (\n    \n    SELECT \n        DATE(fp.Start) AS Date_Jour, \n        op.Description AS Machine,\n        TIMESTAMPDIFF(SECOND, \n            LAG(fp.End) OVER (PARTITION BY fp.OpNo ORDER BY fp.Start), \n            fp.Start\n        ) AS Duree_Arret_Sec\n    FROM \n        `mes4`.`tblfinorderpos` fp\n    JOIN \n        `mes4`.`tbloperation` op ON fp.OpNo = op.OpNo\n    WHERE \n        fp.Start IS NOT NULL AND fp.End IS NOT NULL\n) AS sub\n\nWHERE \n    sub.Duree_Arret_Sec > 0 AND sub.Duree_Arret_Sec < 300 \n\n\nGROUP BY \n    sub.Date_Jour, \n    sub.Machine\n\nORDER BY \n    sub.Date_Jour DESC, \n    Nb_Micro_Arrets DESC
client_cs_name=utf8mb3
connection_cl_name=utf8mb3_general_ci
view_body_utf8=select `sub`.`Date_Jour` AS `Date_Jour`,`sub`.`Machine` AS `Machine`,count(0) AS `Nb_Micro_Arrets`,round(sum(`sub`.`Duree_Arret_Sec`) / 60,1) AS `Minutes_Perdues`,case when count(0) >= 15 then \'CRITIQUE ????\' when count(0) >= 5 then \'ATTENTION ????\' else \'NORMAL ????\' end AS `Niveau_Alerte`,case when count(0) >= 15 then 3 when count(0) >= 5 then 2 else 1 end AS `Code_Couleur` from (select cast(`fp`.`Start` as date) AS `Date_Jour`,`op`.`Description` AS `Machine`,timestampdiff(SECOND,lag(`fp`.`End`,1) over ( partition by `fp`.`OpNo` order by `fp`.`Start`),`fp`.`Start`) AS `Duree_Arret_Sec` from (`mes4`.`tblfinorderpos` `fp` join `mes4`.`tbloperation` `op` on(`fp`.`OpNo` = `op`.`OpNo`)) where `fp`.`Start` is not null and `fp`.`End` is not null) `sub` where `sub`.`Duree_Arret_Sec` > 0 and `sub`.`Duree_Arret_Sec` < 300 group by `sub`.`Date_Jour`,`sub`.`Machine` order by `sub`.`Date_Jour` desc,count(0) desc
mariadb-version=101115
